<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="keywords" content="完美世界" />
<meta name="description" content="完美世界" />
<meta name="viewport" content="width=640,target-densitydpi=320,user-scalable=no">
<link href="style/master.css" rel="stylesheet" type="text/css"/>
<title>来自姜小虎的答谢涵！请查收！</title>
</head>
<body>
<div class="loading center">
	<div class="loadBox">
    	<div id="loadPlay" style="width:0;"></div>
    	<div class="lodingImg"><img src="images/loading.gif" width="200" alt="" /></div>
		<div class="loadText">loading… <span id="loadNumber">0</span></div>
    </div>
</div>
<div class="rel_box">
	<div class="music play" id="musicBtn" style="display:none;"><img src="images/Music-Close.png" alt=""></div>
    <img id="down" class="updown" src="images/down.png" style="display:none;" />
    <img class="shareImg" src="images/share.png" style="display:none;"/>
    <div id="wrap">
        <div id="screen0" class="screen">
        	<div class="scroll">
                <ul class="list">
                    <li class="animated fadeIn">
                        <img src="images/photo-tiger.png" width="78" height="78">
                        <span class="name">姜小虎</span>
                        <div class="detail">
                            <p>Aowoo~你还记得大明湖畔的<br>姜小虎吗？</p>
                            <span></span>
                        </div>
                    </li>
                    <li class="animated fadeIn">
                        <img src="images/photo-tiger.png" width="78" height="78">
                        <span class="name">姜小虎</span>
                        <div class="detail">
                            <img src="images/tiger_face.png" alt="" />
                        </div>
                    </li>
                    <li class="user animated fadeIn">
                        <img src="images/photo-user.png" width="78" height="78">
                        <div class="detail">
                            <p>虎 are you？</p>
                            <span></span>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="bar after">
                <span class="icon-1"></span>
                <div class="input"><p></p></div>
                <span class="icon-2"></span>
                <span class="icon-3"></span>
            </div>
            <div class="area" id="area1">
                <span></span>
            </div>
        </div>
        <div id="screen1" class="screen">
        	<div class="s1_txt letterTxt"></div>
        </div>
        <div id="screen2" class="screen">
        	<div class="iView-t">
            	<h3>&lt;订阅号</h3>姜小虎
            </div>
            <div class="bk_full">最新内容</div>
            <div class="bk_box">
            	<a class="big" href="javascript:;"><img src="images/big.png" alt="" /></a>
                <a class="small small1" href="javascript:;">这个虎崽子有啥魅力呢？<img src="images/small1.png" alt="" /></a>
                <a class="small small2" href="javascript:;">占卜|中国节气知你心 <img src="images/small2.png" alt="" /></a>
            </div>
            <div class="bar after">
                <span class="icon-1"></span>
                <div class="input"><p></p></div>
                <span class="icon-2"></span>
                <span class="icon-3"></span>
            </div>
        </div>
    </div>
    <div class="know_tiger" style="display:none;">
    	<a class="back" href="javascript:;"><img src="images/back.gif" /><span>&lt;&lt;返回</span></a>
    	<div class="know_tiger_content">
        	<div class="know_tiger_box" id="know_tiger_box0"><img src="images/tiger_intro_1.png" alt="" /></div>
        	<div class="know_tiger_box" id="know_tiger_box1"><img src="images/tiger_intro_2.png" alt="" /></div>
        	<div class="know_tiger_box" id="know_tiger_box2"><img src="images/tiger_intro_3.png" alt="" /></div>
        	<div class="know_tiger_box" id="know_tiger_box3"><img src="images/tiger_intro_4.png" alt="" /></div>
        </div>
    </div>
    <div class="tiger_imgs" style="display:none;">
    	<a class="back" href="javascript:;"><img src="images/back.gif" /><span>&lt;&lt;返回</span></a>
    	<div class="iView-t">
            <h3>&lt;订阅号</h3>这个虎崽子有啥魅力
        </div>
    	<img src="images/imgs/img1.jpg" alt="" />
    	<img src="images/imgs/img2.jpg" alt="" />
    	<img src="images/imgs/img3.jpg" alt="" />
    	<img src="images/imgs/img4.jpg" alt="" />
    	<img src="images/imgs/img5.jpg" alt="" />
    	<img src="images/imgs/img6.jpg" alt="" />
    	<img src="images/imgs/img7.jpg" alt="" />
    	<img src="images/imgs/img8.jpg" alt="" />
    	<img src="images/imgs/img9.jpg" alt="" />
    	<img src="images/imgs/img10.jpg" alt="" />
    	<img src="images/imgs/img11.jpg" alt="" />
    	<img src="images/imgs/img12.jpg" alt="" />
    	<img src="images/imgs/img13.jpg" alt="" />
    </div>
    <div class="solarTerms" style="display:none;">
    	<div class="solarTerms_before">
        	<img src="images/solarTerms_t.png" class="solarTerms_t" alt="" />
            <ul class="solarTerms_list">
            	<li><img src="images/gift.png" alt="" /></li>
            	<li><img src="images/gift.png" alt="" /></li>
            	<li><img src="images/gift.png" alt="" /></li>
            	<li><img src="images/gift.png" alt="" /></li>
            	<li><img src="images/gift.png" alt="" /></li>
            	<li><img src="images/gift.png" alt="" /></li>
            	<li><img src="images/gift.png" alt="" /></li>
            	<li><img src="images/gift.png" alt="" /></li>
            	<li><img src="images/gift.png" alt="" /></li>
            </ul>
            
        </div>
    	<div class="solarTerms_loading" style="display:none;">
        	<div class="solarTerms_box">
            	<img src="images/tiger_loading.png" alt="" />
                <p class="numerical">0</p>
            </div>
        </div>
    	<div class="solarTerms_after" style="display:none;">
        	<ul class="solarTerms_info">
            	<li class="solarTerms_info_1"><img src="images/solarterms/lichun_txt.png" class="solarTerms_info_txt" alt="" /></li>
            	<li class="solarTerms_info_2"><img src="images/solarterms/daxue_txt.png" class="solarTerms_info_txt" alt="" /></li>
            	<li class="solarTerms_info_3"><img src="images/solarterms/dongzhi_txt.png" class="solarTerms_info_txt" alt="" /></li>
            	<li class="solarTerms_info_4"><img src="images/solarterms/hanlu_txt.png" class="solarTerms_info_txt" alt="" /></li>
            	<li class="solarTerms_info_5"><img src="images/solarterms/lidong_txt.png" class="solarTerms_info_txt" alt="" /></li>
            	<li class="solarTerms_info_6"><img src="images/solarterms/qiufen_txt.png" class="solarTerms_info_txt" alt="" /></li>
            	<li class="solarTerms_info_7"><img src="images/solarterms/shuangjiang_txt.png" class="solarTerms_info_txt" alt="" /></li>
            	<li class="solarTerms_info_8"><img src="images/solarterms/xiaohan_txt.png" class="solarTerms_info_txt" alt="" /></li>
            	<li class="solarTerms_info_9"><img src="images/solarterms/guyu_txt.png" class="solarTerms_info_txt" alt="" /></li>
            </ul>
        </div>
    </div>
</div>
<audio id="music" class="none" src="http://media101.wanmei.com/media/wanmei/201603/tiger/music.mp3" loop preload="preload"></audio>
<script type="text/javascript" src="http://zhuxian.wanmei.com/js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="http://www.wanmei.com/public/js/stat.js"></script>
<script src="http://www.wanmei.com/public/js/weixin.js"></script>
<script type="text/javascript">
(function($){
	$.fn.animateProgress = function(progress, duration, callback) {
		return this.each(function() {
			$(this).animate({
				width: progress + '%'
			}, {
				duration: duration,
				easing: 'swing',
				step: function(progress){
					$("#loadNumber").html(Math.ceil(progress)+"%");
				},
				complete: function(scope, i, elem) {
					if (callback) {
						callback.call(this, i, elem );
					};
				}
			});
		});
	};
})(jQuery);
$(function(){
	$('#loadPlay').animateProgress(87, 1200, function() {});
	window.onload = function () {
		$('#loadPlay').animateProgress(100, 300, function() {
			$('.loading').hide();
			//$('#musicBtn').show();
			var music = document.getElementById('music');
				music.play();
				screenN(0);
			$('body').bind("touchmove",function(e){    
				e.preventDefault();    
			}); 
		});
	};
	/*window.onload = function () {
		screenN(0);
	};*/
	var music = document.getElementById('music'),
		musicFlag = true;
	$('.music').on("touchstart",function(){
		if(musicFlag){
			musicFlag = false;
			$(this).removeClass('play');
			music.pause();
			$(this).children("img").show();
		}else{
			musicFlag = true;					
			$(this).addClass('play');
			music.play();
			$(this).children("img").hide();
		}
	});
	var now = 0, len = $('.screen').size(), touchs = touche = 0, h =$('.rel_box').height(),isRun=false,flag=true,webpage,knowTigerLen = $('.know_tiger_box').size(),knowTigerNow=0;
	$('#wrap,.screen,.know_tiger,.know_tiger_box').css('height',h);
	$('#screen2').css('top',h);
	var Tool = {
		randomSection:function(minnum,maxnum){
			return Math.floor(minnum+Math.random()*(maxnum-minnum));
		}
	}
	//大图点击
	$('.bk_box .big').bind('touchend',function(event){
		event.preventDefault();
		$('.know_tiger').fadeIn(300);
		//$('.know_tiger .iView-t').css('position','fixed');
		$('.updown').fadeIn(500);
		$('#wrap').hide();
	});
	//小图1点击
	$('.bk_box .small1').bind('touchend',function(event){
		event.preventDefault();
		$('.tiger_imgs').fadeIn(300);
		//$('.tiger_imgs .iView-t').css('position','fixed');
		$('.updown').hide();
		$('#wrap').hide();
		$("body").unbind("touchmove"); 
	});
	//返回订阅号
	$('.know_tiger .iView-t,.tiger_imgs .iView-t').bind('touchend',function(event){
		event.preventDefault();
		$(this).parent().fadeOut();
		$('#wrap').show();
	});
	var timer=null,timers=null;
	var count=0;
	
	//小图2点击
	$('.bk_box .small2').bind('touchend',function(event){
		event.preventDefault();
		$('.solarTerms').fadeIn(300);
		$('.updown').hide();
		$(".solarTerms_list li").each(function(i) {
			var _this=$(this);
			setTimeout(function(){
				_this.find('img').css({'transition-duration':'0.5s','transform':'rotate(360deg)','transform-origin':'center'});
			},i*100);
		});
		timers=setInterval(function(){
			$('.solarTerms_list li').removeClass('a-flicker').eq(Tool.randomSection(0,9)).addClass('a-flicker');
		},3000)
	});
	$('.solarTerms_list li').bind('touchend',function(event){
		event.preventDefault();
		var index = $(this).index();
		clearInterval(timers);
		$('.solarTerms_before').fadeOut();
		$('.solarTerms_loading').fadeIn();
		timer=setInterval(function(){
			var num = $('.solarTerms_loading .numerical');
			var schedule=Tool.randomSection(0,20);
			count=count+schedule;
			num.html(count+'%');
			if(count>=100){
				count=100;
				num.html(count+'%');
				clearInterval(timer);
				$('.solarTerms_loading').fadeOut();
				$('.solarTerms_after').fadeIn();
				$('.solarTerms_info li').hide().find('img').removeClass('an_fadeLeft');
				$('.solarTerms_info li').eq(index).fadeIn('slow').find('img').addClass('an_fadeLeft');
				setTimeout(function(){
					$('.shareImg').show();	
				},3000)
			}
		},200);
	});
	
	
	function resetAnm(){//恢复动画原状态
		$('#screen2 .iView-t').removeClass('a-bounceinT');
		$('#screen2 .bk_full').removeClass('a-fadein');
		$('#screen2 .bk_box').removeClass('a-fadeinB');
		$('#screen2 .bar').removeClass('a-bounceinB');
	}
	function screenN(n){
		resetAnm();
		clearTimeout(webpage);
		switch(n) {
			case 0 :
				chatList();
				break;
			case 1 :
				$('#screen2 .iView-t').addClass('a-bounceinT');
				setTimeout(function(){
					$('#screen2 .bk_full').addClass('a-fadein');
				},1000)
				setTimeout(function(){
					$('#screen2 .bk_box').addClass('a-fadeinB');
				},2000)
				$('#screen2 .bar').addClass('a-bounceinB');
				$('.updown').hide();
				break;
		}
		$('#wrap').css({'transition-duration':'0.5s','transform':'translate3d(0,-'+n*(parseInt(h))+'px,0)'})
	}
	function knowTiger(n){
		switch(n) {
			case 3 :
				$('.updown').fadeOut();
				break;
			default:
				$('.updown').fadeIn();
				break;
		}
		$('.know_tiger_content').css({'transition-duration':'0.5s','transform':'translate3d(0,-'+n*(parseInt(h))+'px,0)'});
	}
	//返回
	$('.know_tiger .back').on('touchend',function(e){
		e.preventDefault();
		$(this).parent().hide();/*.css({'transform':'translateX(-100%)','transition-duration':'0.5s'});*/
		$('.updown').fadeOut();
		knowTigerNow=0;
		knowTiger(knowTigerNow);
		$('#wrap').show();
	});
	$('.tiger_imgs .back').on('touchend',function(e){
		e.preventDefault();
		$(this).parent().hide();/*.css({'transform':'translateX(-100%)','transition-duration':'0.5s'});*/
		$('.updown').fadeOut();
		$('#wrap').show();
	});
	$('.know_tiger_content').on('touchmove',function(e){
		e.preventDefault();
	});
	$('.know_tiger_content').on('touchstart',function(e){
		touchs = e.originalEvent.touches[0].pageY;
	});
	$('.know_tiger_content').on('touchend',function(e){
		touche = e.originalEvent.changedTouches[0].pageY;
		if(knowTigerNow < (knowTigerLen - 1) && (touche - touchs) < -20){
			if(knowTigerNow==4&&isRun){
				return false;
			}else{
				isRun=true;
				knowTigerNow++;	
				knowTiger(knowTigerNow);
			}
		}
		if(knowTigerNow > 0 && (touche - touchs) > 20){
			knowTigerNow--;
			knowTiger(knowTigerNow);
		}
	});
	/*document.getElementById("z1_1").addEventListener("webkitAnimationEnd",function(e){
		$('.z1_1').hide();
		$('.ren1_1').hide();
		$('.ren1_2').show();
		$('.ren1_3').addClass('flicker');
	},false);*/


	/*$(document).on('touchmove',function(e){
		e.preventDefault();
	});
	$(document).on('touchstart',function(e){
		touchs = e.originalEvent.touches[0].pageY;
	});
	$(document).on('touchend',function(e){
		touche = e.originalEvent.changedTouches[0].pageY;
		if(now < (len - 1) && (touche - touchs) < -20){
			if(now==4&&isRun){
				return false;
			}else{
				isRun=true;
				now++;	
				screenN(now);
			}
		}
		if(now > 0 && (touche - touchs) > 20){
			now--;
			screenN(now);
		}
	});*/
	$('.redpacket').click(function(){
		$(this).hide();
		$('.redpacket_open').show();
		isRun=false;
	})
	function imgShow(name1,name2){
		function sports2(){
			if($(name1).is(":hidden")){
				$(name1).show();
				$(name2).hide();
			}else{
				$(name1).hide();
				$(name2).show();
			}
			webpage = setTimeout(arguments.callee,500);
			flag = true;
		}
		setTimeout(sports2,500);
	}  
	$('.shareImg').click(function(){
		$(this).hide();
	})
	function chatList(){
		$('.updown').fadeIn();
		setTimeout(function(){
			$('#screen0 .list li:eq(0)').fadeIn();
			setTimeout(function(){
				$('#screen0 .list li:eq(1)').fadeIn();
			},500);
		},500);
		setTimeout(function(){
			$('#screen0').addClass('after');
			$('#screen0.after .input p').html('虎 are you？<span></span>');
			//$('#screen0 .scroll').scrollTop( $('#p-chat .scroll')[0].scrollHeight );
		},1500);
	}
	$('#screen0 #area1').bind('touchend',function(event){
		event.preventDefault();
		$('#screen0').removeClass('after');
		$('#screen0 .list li:eq(2)').show();
		setTimeout(function(){
			$('#screen1').fadeIn();
			$('.s1_txt').addClass('letterTxt');
			setTimeout(function(){
				$('.updown').fadeIn();
			},4000)
		},1500)
	});

	$('#screen0').on('touchmove',function(e){
		e.preventDefault();
	});
	$('#screen0').on('touchstart',function(e){
		touchs = e.originalEvent.touches[0].pageY;
	});
	$('#screen0').on('touchend',function(e){
		touche = e.originalEvent.changedTouches[0].pageY;
		if((touche - touchs) > 20){
			$('#screen1').fadeIn();
			$('.s1_txt').addClass('letterTxt');
			setTimeout(function(){
				$('.updown').fadeIn();
			},4000)
		}
	});
	$('#screen1').on('touchmove',function(e){
		e.preventDefault();
	});
	$('#screen1').on('touchstart',function(e){
		touchs = e.originalEvent.touches[0].pageY;
	});
	$('#screen1').on('touchend',function(e){
		touche = e.originalEvent.changedTouches[0].pageY;
		if((touche - touchs) < -20){
			now=1;	
			screenN(now);
		}
	});
	/*document.querySelector('body').addEventListener('touchstart', function (ev) {
		ev.preventDefault();
	});*/
	wx.ready(function(){
		wx.onMenuShareAppMessage({
			title: '来自姜小虎的答谢涵！请查收！',
			desc: '这是我虎生中最好的森日礼物！谢谢你！',
			link: window.location.href,
			imgUrl: 'http://event51.wanmei.com/wanmei/201603/tiger/images/share.jpg',
			trigger: function (res) {
				// 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
				//alert('用户点击发送给朋友');
			},
			success: function (res) {
				//
			},
			cancel: function (res) {
				//alert('已取消');
			},
			fail: function (res) {
				alert(JSON.stringify(res));
			}
		});
	
		wx.onMenuShareTimeline({
			title: '来自姜小虎的答谢涵！请查收！',
			link: window.location.href,
			imgUrl: 'http://event51.wanmei.com/wanmei/201603/tiger/images/share.jpg',
			trigger: function (res) {
				// 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
				//alert('用户点击分享到朋友圈');
			},
			success: function (res) {
				//
			},
			cancel: function (res) {
				//alert('已取消');
			},
			fail: function (res) {
				alert(JSON.stringify(res));
			}
		});
	});
});
</script>
</body>
</html>

